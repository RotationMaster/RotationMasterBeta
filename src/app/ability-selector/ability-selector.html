<div class="dropdown-container">
  <select
    class="nisinput separator-selector"
    [(ngModel)]="abilitySelection.Separator"
    (ngModelChange)="onSeparatorChange($event)"
    [disabled]="isFirst"
    [style.visibility]="isFirst ? 'hidden' : 'visible'"
    >
    @for (sep of separators; track sep) {
      <option [value]="sep">{{ sep || '(none)' }}</option>
    }
  </select>

  <rm-search-dropdown
    [items]="abilities"
    [selectedAbility]="abilitySelection.SelectedAbility"
    (afterChange)="onAbilityChange($event)"
  ></rm-search-dropdown>

  <div class="ability-image-container">
    @if (abilitySelection.SelectedAbility) {
      <img
        class="ability-image"
        [src]="abilitySelection.SelectedAbility.Src"
        [alt]="abilitySelection.SelectedAbility.Emoji"
        />
    }
  </div>

  <input
    type="text"
    class="nisinput ability-notes-input"
    [(ngModel)]="abilitySelection.Notes"
    (ngModelChange)="onNotesChange($event)"
    />

  <div class="button-dropdown">
    <button
      class="nisbutton copy-button"
      (click)="copy.emit('end')"
      (contextmenu)="$event.preventDefault(); copyMenuVisible = !copyMenuVisible"
      title="Copy Ability (Right-click for more options)"
      [disabled]="!abilitySelection.SelectedAbility"
      >
      <i class="fa-solid fa-copy"></i>
    </button>
    
    <!-- Context Menu -->
    <div class="copy-context-menu" *ngIf="copyMenuVisible" (mouseleave)="copyMenuVisible = false">
      <button class="context-menu-item" (click)="copy.emit('after'); copyMenuVisible = false">
        <i class="fa-solid fa-arrow-right"></i> Copy Here
      </button>
      <button class="context-menu-item" (click)="copy.emit('end'); copyMenuVisible = false">
        <i class="fa-solid fa-arrow-down"></i> Copy to End
      </button>
    </div>
  </div>

  <button
    class="nisbutton delete-button"
    (click)="delete.emit()"
    title="Delete Ability Selection"
    [disabled]="isOnly"
    >
    <i class="fas fa-trash-alt"></i>
  </button>
</div>
